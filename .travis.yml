os: linux
dist: trusty

language: minimal
sudo: required

services:
  - docker

after_success:
  - bash <(curl -s https://codecov.io/bash)

matrix:
  include:
# ---------------------------------------------
# AMD64: Build and Test
# ---------------------------------------------
    - env:
        - ARCH="amd64"

      script:
        # Build
        - docker run --rm -it -v "$(pwd)":/mnt kuzzleio/sdk-cross:golang ./.ci/setup_and_test.sh

# ---------------------------------------------
# I386: Build and Test
# ---------------------------------------------
    - env:
        - ARCH="i386"

      script:
        # Build
        - docker run --rm -it -v "$(pwd)":/mnt kuzzleio/sdk-cross:golang-i386 ./.ci/setup_and_test.sh

# ---------------------------------------------
# ARMV7: Build and Test
# ---------------------------------------------
    - env:
        - ARCH="armhf"

      script:
        # Build
        - docker run --rm --privileged multiarch/qemu-user-static:register
        - docker run --rm -it -v "$(pwd)":/mnt kuzzleio/sdk-cross:armhf-golang-runner taskset -c 1 ./.ci/setup_and_test.sh

# ---------------------------------------------
# ARMV8: Build and Test
# ---------------------------------------------
    - env:
        - ARCH="aarch64"

      script:
        # Build
        - docker run --rm --privileged multiarch/qemu-user-static:register
        - docker run --rm -it -v "$(pwd)":/mnt kuzzleio/sdk-cross:aarch64-golang-runner taskset -c 1 ./.ci/setup_and_test.sh
