jobs:
  include:
# ---------------------------------------------
# Linux Builds
# ---------------------------------------------
    - name: "Linux amd64 - Go latest (with coverage)"
      os: linux
      dist: xenial
      sudo: true

      language: go
      go: "master"

      cache:
        directories:
          - $HOME/.cache/go-build
          - $HOME/gopath/pkg
      
      script:
        - export GOOS=linux 
        - export GOARCH=amd64
        - ./.ci/test_with_coverage.sh

      after_success:
        - bash <(curl -s https://codecov.io/bash)

    - name: "Linux amd64 - Go 1.11.x"
      os: linux
      dist: xenial
      sudo: true

      language: go
      go: "1.11.x"

      cache:
        directories:
          - $HOME/.cache/go-build
          - $HOME/gopath/pkg
      
      script:
        - export GOOS=linux 
        - export GOARCH=amd64
        - go test -v ./...

    - name: "Linux amd64 - Go 1.10.x"
      os: linux
      dist: xenial
      sudo: true

      language: go
      go: "1.10.x"

      cache:
        directories:
          - $HOME/.cache/go-build
          - $HOME/gopath/pkg
      
      script:
        - export GOOS=linux 
        - export GOARCH=amd64
        - go test -v ./...

    - name: "Linux i386 - Go latest"
      os: linux
      dist: xenial
      sudo: true

      language: go
      go: "master"

      cache:
        directories:
          - $HOME/.cache/go-build
          - $HOME/gopath/pkg
      
      script:
        - export GOOS=linux 
        - export GOARCH=386
        - go test -v ./...

    - name: "Linux i386 - Go 1.11.x"
      os: linux
      dist: xenial
      sudo: true

      language: go
      go: "1.11.x"

      cache:
        directories:
          - $HOME/.cache/go-build
          - $HOME/gopath/pkg
      
      script:
        - export GOOS=linux 
        - export GOARCH=386
        - go test -v ./...

    - name: "Linux i386 - Go 1.10.x"
      os: linux
      dist: xenial
      sudo: true

      language: go
      go: "1.10.x"

      cache:
        directories:
          - $HOME/.cache/go-build
          - $HOME/gopath/pkg
      
      script:
        - export GOOS=linux 
        - export GOARCH=386
        - go test -v ./...

    - name: "Linux arm64 - Go latest"
      os: linux
      dist: xenial
      sudo: true

      addons:
        apt:
          packages:
          - qemu-user-static

      language: go
      go: "master"

      cache:
        directories:
          - $HOME/.cache/go-build
          - $HOME/gopath/pkg
      
      script:
        - export GOOS=linux 
        - export GOARCH=arm64
        - taskset -c 1 go test -v -exec "qemu-aarch64-static" ./...

    - name: "Linux arm64 - Go 1.11.x"
      os: linux
      dist: xenial
      sudo: true

      addons:
        apt:
          packages:
          - qemu-user-static

      language: go
      go: "1.11.x"

      cache:
        directories:
          - $HOME/.cache/go-build
          - $HOME/gopath/pkg
      
      script:
        - export GOOS=linux 
        - export GOARCH=arm64
        - taskset -c 1 go test -v -exec "qemu-aarch64-static" ./...

    - name: "Linux armhf - Go latest"
      os: linux
      dist: xenial
      sudo: true

      addons:
        apt:
          packages:
          - qemu-user-static

      language: go
      go: "master"

      cache:
        directories:
          - $HOME/.cache/go-build
          - $HOME/gopath/pkg
      
      script:
        - export GOOS=linux 
        - export GOARCH=arm
        - export GOARM=7
        - taskset -c 1 go test -v -exec "qemu-arm-static" ./...

    - name: "Linux armhf - Go 1.11.x"
      os: linux
      dist: xenial
      sudo: true

      addons:
        apt:
          packages:
          - qemu-user-static

      language: go
      go: "1.11.x"

      cache:
        directories:
          - $HOME/.cache/go-build
          - $HOME/gopath/pkg
      
      script:
        - export GOOS=linux 
        - export GOARCH=arm
        - export GOARM=7
        - taskset -c 1 go test -v -exec "qemu-arm-static" ./...

    - name: "Linux armhf - Go 1.10.x" 
      # Only performed on armhf because QEMU static not already 
      # stabilized for Go 1.10.x and arm64 but behavior should be the same
      os: linux
      dist: xenial
      sudo: true

      addons:
        apt:
          packages:
          - qemu-user-static

      language: go
      go: "1.10.x"

      cache:
        directories:
          - $HOME/.cache/go-build
          - $HOME/gopath/pkg
      
      script:
        - export GOOS=linux 
        - export GOARCH=arm
        - export GOARM=7
        - taskset -c 1 go test -v -exec "qemu-arm-static" ./...

# ---------------------------------------------
# MacOS Builds
# ---------------------------------------------
    - name: "MacOS amd64 - Go latest"
      os: osx

      language: go
      go: "master"

      cache:
        directories:
          - $HOME/Library/Caches/go-build
          - $HOME/gopath/pkg

      script:
        - export GOOS=darwin
        - export GOARCH=amd64
        - go test -v ./...

    - name: "MacOS amd64 - Go 1.11.x"
      os: osx

      language: go
      go: "1.11.x"

      cache:
        directories:
          - $HOME/Library/Caches/go-build
          - $HOME/gopath/pkg

      script:
        - export GOOS=darwin
        - export GOARCH=amd64
        - go test -v ./...

    - name: "MacOS amd64 - Go 1.10.x"
      os: osx

      language: go
      go: "1.10.x"

      cache:
        directories:
          - $HOME/Library/Caches/go-build
          - $HOME/gopath/pkg

      script:
        - export GOOS=darwin
        - export GOARCH=amd64
        - go test -v ./...

    - name: "MacOS i386 - Go latest"
      os: osx

      language: go
      go: "master"

      cache:
        directories:
          - $HOME/Library/Caches/go-build
          - $HOME/gopath/pkg

      script:
        - export GOOS=darwin
        - export GOARCH=386
        - go test -v ./...

    - name: "MacOS i386 - Go 1.11.x"
      os: osx

      language: go
      go: "1.11.x"

      cache:
        directories:
          - $HOME/Library/Caches/go-build
          - $HOME/gopath/pkg

      script:
        - export GOOS=darwin
        - export GOARCH=386
        - go test -v ./...

    - name: "MacOS i386 - Go 1.10.x"
      os: osx

      language: go
      go: "1.10.x"

      cache:
        directories:
          - $HOME/Library/Caches/go-build
          - $HOME/gopath/pkg

      script:
        - export GOOS=darwin
        - export GOARCH=386
        - go test -v ./...

# ---------------------------------------------
# Windows Builds
# ---------------------------------------------
    - name: "Windows amd64 - Go latest"
      os: windows

      language: go
      go: "1.12.x"

      script:
        - GOOS=windows
        - GOARCH=amd64
        - go test -v ./...

    - name: "Windows amd64 - Go 1.11.x"
      os: windows

      language: go
      go: "1.11.x"

      script:
        - GOOS=windows
        - GOARCH=amd64
        - go test -v ./...

    - name: "Windows amd64 - Go 1.10.x"
      os: windows

      language: go
      go: "1.10.x"

      script:
        - GOOS=windows
        - GOARCH=amd64
        - go test -v ./...

    - name: "Windows i386 - Go latest"
      os: windows

      language: go
      go: "1.12.x"

      script:
        - GOOS=windows
        - GOARCH=386
        - go test -v ./...

    - name: "Windows i386 - Go 1.11.x"
      os: windows

      language: go
      go: "1.11.x"

      script:
        - GOOS=windows
        - GOARCH=386
        - go test -v ./...

    - name: "Windows i386 - Go 1.10.x"
      os: windows

      language: go
      go: "1.10.x"

      script:
        - GOOS=windows
        - GOARCH=386
        - go test -v ./...

